test_keys = [[-4156369652506573902983420521981490286762715372766841926153669432866162051376535073962900010342866256180385564459698373122331118465474668351173348513255681,
-2028753393783917315584813380772581570984442228275746993119736332459276770749071413367333353441342599581577493678599822468759972883070718808792671716516980, 8453370159311786859845047936461358755218651398480900842662461944180871146882372453672085998761802156521194695479132113049483133590751895870880695703734426,
-2424513275953601033400781768372609159707553131968516364680519118878871620914919667229851262225451726530253027793554724673918118144986660584270508917067011,
-4056590393890429248072703275607943147108387790810438007136974091253993775270870204636960244769093608442044623400447205046886027375217317287556504127922965],
[ -674285656960176273128720299486080762025330995632120679596714808883659231888805242247533426548748840023012878272344755603204853057977636713758166036688064,
-329123593257111593145990699547804346369072916497468359163450467914026056041519508873563862890288061227541665835228725189136080644507550209245382592170581,
-4258854873178501325200062051717160898850136478193901587138394313013011401274801925990204890202503602032052263528877611752910252724320192348277164174842752,
6333248110565428775463610588267982019299028592724066186784008356513974940249996191290449600395713372014390026042556163418609280994317647704528051655441235,
-9116186740982973608971185414761475108938998990838167643424366766774388972640217403711671277871575263319899513388958113897921809162654323831474105623165115],
[12226289303250501173578619056476985579801068095759406925632165267950209346328932466228025364414575473250085467403670876615686491605229010769213540995825213,  5967738192486051682600600921595714526601808468356422693399444628374651028568684108974912233603724505842311811975388690343432228822002108194967649184746542,
-455905026079321440694785793142550687631308483223776752595500339239187462743453970807058951997875191283818698269206515830612371111799527381143078045685335,
-5788368123195218290411626101212287139901342730517308798581980045184819454588250664619668688866601578023417911403362616304157385636492217787579948105720791,
-2978377031752422880468243839071083034808589049678490523262466174574964164203230661509159644483429723854543151107262395453822711459506310136635953702725865],
[12389809153105849091555318886086652083436366033408507218801714365075681520931744993500445968968943974963920133943348775406327727980037802678498194018917897,  6047553386532859094707189281303687081766358914525767021472086207598626553603291929796604145198157452524843342506921219611751665271968433156405943835879758, 18879723064335157177547707925360980231339759681870408628992139464877099088227065474177988877855087672030927677342924161543123627121554182647841115786081749, 22922995464467664806465990987317575381201008457691367940555252815509821678326066344104307458820542258963978638212158022635732185102965238395683083563546326, 4252785072618222226142138004861623444552027793527175819637114474379754980380682935962467978655197582816090156566027736232105532807058330267512631338549539]]

#One of the resulting rows from LLL should be of the form [d, m = (e * d - 1) / (n - k), ((k * m + 1))] (where the last value is split into words of size b each)
#so assemble x by doing x = v3*b^2 + v4*b + v5

from keyagreement import *
from backdoor import recover_key

b = 2 ** 520
n = PARAMETERS['n']
pub, priv = generate_keypair()

for test_key in test_keys:
    d = test_key[0]
    m = test_key[1]
    x = (test_key[2] * (b ** 2)) + (test_key[3] * b) + test_key[4]
    k = (x - 1) / m
    test_priv = (d, n, n - k)
    _priv = recover_key(pub, test_priv)
    print _priv == priv